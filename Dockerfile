FROM eclipse-temurin:17-jdk-jammy AS java-test

WORKDIR /app
ENV CODEARTIFACT_AUTH_TOKEN="eyJ2ZXIiOjEsImlzdSI6MTY2OTYyODQyMywiZW5jIjoiQTEyOEdDTSIsInRhZyI6Im05R1hlZ2Q5NTlyS2xTMTI3VWdIOUEiLCJleHAiOjE2Njk2NzE2MjMsImFsZyI6IkExMjhHQ01LVyIsIml2IjoiaHd3My02UjRLVC1oZm15RCJ9.IzVJOCqiBTV9pyQKjPwbWw.tUirS4z5-TmjLN4Q._vUJGHqKQMnYFvG09ak0GfDPCn1GolJ9-6ARXtIZm5uZmpIWKKyeLXUSZWj4xwnxcPSVNdq3vAmW64EzVlndJ-uQGJT5kGKSZdiLeA6skl-z9ghk0ySIcNXK5TWXAjR5f_nNelBYaSx4TcNY6wNQfSowO9sBeK_N0OtcRjPqVRSkG11H_RM_5_0g9Mo1G34o-kVjxYyW3mEN0QgmxxUTWHN59cyS-CCy-TnjprgJLmitzgJK7B1gDxllM26HcyqPdiKJDmxZOG_x5Qzvy4joSON_n9BGTJ4BxqAM4C66rouUMjaHf4EeGvfWwB0NRxT_oBb9WvF8RGvjrTvizCrg8NkiDrBG4RP1DG7naIxPMvDcMqMNoB0nJ_z42n6e4MebVaWutOfakZdPlYJbfdTfRpg-03xS88dmEm5mxkd4VKExK-AgtJcgleDOu8j1rbv-cmsktVGoayXtKC9atSV91w1pHhKkeb9tQQEw6Cyd3XHeK1JbyHKb-i2YyKHzQcjO57N9Kg1pulzaV94Q4uR6RMfxcBgyCKbFEayoM5y7LgYugFcfsMt76UerUvZxzdBBhrbK8GwlKDSntQ2LYavsPqhjr_PPjcC4zc7dkVyJnqjYPgpKKhGcu2L_3DVMm079dMrX5ANY61VbAgij8hShKa73o5WUOzgPKRMw5sVg3xycZFvdWqoS3P16oBJCWPflGtFQEXBNb40SlpOyuRezB9-1P3b1JeO4It1tT0k3dcK6JJSQhpvvVLW3uwZvrQ9CHJ_bjutfITKD_xdSfNHRLTyhr_LDG7bpdveY7QVp8-qrv4Pw3pqbRZBh5I9cXRa-azOeBfBq6x_M1i0aQZBgqYsBa4nJLS9GoWSa6CwYiLeLhVrGMXv_-6mAqCvDGZn0eewfvVVWvOyt58VYZj60l9JtbKgUK-Yi.bFqXYj1LBHG6e4sDOylwFQ"
COPY .mvn/ .mvn
COPY mvnw pom.xml ./
COPY code ./code
COPY test ./test
COPY maven/settings.xml /root/.m2/

RUN ./mvnw dependency:resolve

CMD ["./mvnw", "verify"]
